# 局域网一体化协作平台 - 需求文档 (草案)

版本: 0.1
日期: 2025年4月26日

## 1. 引言

*   **1.1 项目背景**: 当前公司内部跨部门（研发、测试、运维、产品等）协作过程中存在信息孤岛、流程脱节、职责不清、环境与配置管理复杂、问题追溯困难等效率问题。为了解决这些痛点，提升整体工作效率和质量，计划开发一款部署在公司局域网内的一体化协作平台。
*   **1.2 项目目标**:
    *   集中管理**用户**、**职责**、**环境**、**资产**、**服务**、**业务**、**配置**、文档等关键信息。
    *   明确各环节、各资源的负责人，实现高效协同和问题快速定位。
    *   自动化收集关键信息，简化问题（**Bug**）报告和复现流程。
    *   为不同角色提供统一、权限可控的访问入口和操作界面。
    *   打通从需求、设计、开发、编译、部署、测试到运维的完整工作流。
    *   搭建一个基础能力共享的支撑平台。
*   **1.3 项目范围**: 开发一套包含客户端、服务端和**数据采集器**的局域网软件系统，实现本文档所述的核心功能。初期重点在于内部流程的打通和信息的集中管理。
*   **1.4 目标用户**: 公司内部的产品经理、研发工程师、测试工程师、运维工程师等所有参与软件生命周期的员工。

## 2. 系统核心功能需求

### 2.1 用户与职责管理 (User & Responsibility Management)

*   **2.1.1 用户管理**:
    *   支持**用户**账号的创建、编辑、禁用/启用、删除。
    *   记录**用户**基本信息（姓名、部门、邮箱、联系方式等）。
    *   为**用户**分配系统角色（如：管理员、研发、测试、运维、产品、只读等），控制其访问权限。
*   **2.1.2 职责定义**:
    *   定义系统中需要明确责任归属的"**职责**"（例如："用户模块后端开发职责"、"订单服务测试职责"、"生产环境部署职责"、"XX客户定制环境维护职责"等）。
*   **2.1.3 职责组 (Responsibility Group)**:
    *   每个"**职责**"由一个"**职责组**"承担。
    *   一个"**职责组**"可以包含一个或多个**用户**，形成主备或共同负责的关系。
    *   当任务或问题关联到某个"**职责**"时，通知或分配给该"**职责组**"。**（待明确：具体通知规则，例如总是通知主负责人，抄送其他成员，或根据任务类型决定）**。
*   **2.1.4 关联性**: **用户**可以属于多个**职责组**。后续所有需要明确负责人的模块（**环境**、**资产**、**服务**、**业务**、**需求**、测试、**Bug** 等）都必须关联到相应的"**职责**"或"**职责组**"。

### 2.2 环境管理 (Environment Management)

*   **2.2.1 环境定义**:
    *   支持创建和管理不同类型的**环境**（如：开发联调环境、功能测试环境、性能测试环境、预发布环境、生产环境、特定客户定制环境等）。
    *   记录**环境**的基本信息（名称、代号、用途描述、状态：活跃/维护中/已归档）。
*   **2.2.2 环境组成**:
    *   关联**环境**中包含的"**服务**"（见 2.4）、"**资产**"（见 2.3，包括服务器、网络配置段等）。
    *   记录**环境**特定的网络拓扑描述或示意图。
*   **2.2.3 职责关联**: 每个**环境**或**环境**中的关键部分（如特定网络区域）需要关联到负责维护或使用的"**职责组**"。

### 2.3 资产管理 (Asset Management)

*   **2.3.1 服务器管理**:
    *   记录服务器信息：主机名/IP 地址、操作系统、物理/虚拟、所属机房/云、CPU/内存/磁盘规格、访问方式（SSH/RDP 地址、端口、凭证管理方式）、公网 IP（如有）、VPN 配置要求（如有）。
    *   记录服务器承载的"**服务**"实例。
    *   关联服务器所属的"**环境**"。
    *   关联服务器的管理"**职责组**"。
*   **2.3.2 网络管理**:
    *   定义网络区域/VLAN/子网信息。
    *   记录关键网络设备（防火墙、路由器、交换机、网闸）的基本信息和配置摘要（如有必要）。
    *   描述不同**环境**的网络拓扑特点（公网、私网、混合、VPN 接入方式、访问控制策略等）。
    *   关联网络资源所属的"**环境**"。
    *   关联网络资源的管理"**职责组**"。
*   **2.3.3 终端/客户端管理**:
    *   记录公司使用的软件客户端类型（如：PC客户端、Web管理端、移动App）。
    *   记录客户端的版本号、支持的操作系统。
    *   关联客户端对应的"**业务**"或功能。
    *   关联客户端开发/测试的"**职责组**"。

### 2.4 服务管理 (Service Management)

*   **2.4.1 服务定义**:
    *   定义公司内部的各种微服务或应用**服务**（如：媒体网关、信令网关、转发服务、录制服务、转码服务、用户服务、订单服务等）。
    *   记录**服务**的类型、功能描述、主要接口说明（或链接到文档）。
*   **2.4.2 服务版本/分支管理**:
    *   记录**服务**的主要开发分支（对应代码库分支）。
    *   记录**服务**的重要版本号及其发布说明。
*   **2.4.3 部署实例**:
    *   记录**服务**在不同"**环境**"下的部署实例信息（部署在哪台"服务器"上、端口号、运行状态等）。
*   **2.4.4 职责关联**: 每个**服务**类型需要关联到负责开发、测试、运维的"**职责组**"。

### 2.5 业务管理 (Business/Application Management)

*   **2.5.1 业务定义**:
    *   定义公司的核心**业务**或应用系统。
    *   支持**业务**分解为子**业务**或功能模块。
*   **2.5.2 文档与设计**:
    *   关联**业务**相关的设计文档、架构图、配置说明、部署手册等（支持上传附件或链接到文档库）。
*   **2.5.3 关联性**:
    *   关联该**业务**依赖的"**服务**"。
    *   关联支持该**业务**的"客户端类型"。
    *   关联该**业务**部署的"**环境**"。
*   **2.5.4 职责关联**: 每个**业务**或重要子**业务**需要关联到负责产品、开发、测试的"**职责组**"。

### 2.6 需求管理 (Requirement Management)

*   **2.6.1 需求定义**:
    *   记录**需求**的基本信息（ID、标题、描述、来源、优先级、状态：待评审/设计中/开发中/已完成/已拒绝）。
    *   关联**需求**所属的"**业务**"。
*   **2.6.2 环境支持**: 明确该**需求**需要在哪（些）"**环境**"类型上实现和验证。
*   **2.6.3 设计转化**:
    *   **需求**确认后，可以转化为具体的"**业务**"设计任务。
    *   关联**需求**的设计文档、技术方案。
    *   关联为实现此**需求**需要修改或新增的"**服务**"及交互方式。
    *   关联**配置**和部署要求。
*   **2.6.4 职责关联**: 每个**需求**需要关联到负责产品、开发、测试的"**职责组**"。

### 2.7 编译环境管理 (Build Environment Management)

*   **2.7.1 编译配置**:
    *   记录不同"**服务**"或"**业务**"在不同场景（如不同操作系统、不同目标"**环境**"）下的编译脚本、依赖项、编译参数、打包方式。
    *   关联开发分支与编译**配置**。
*   **2.7.2 职责关联**: 编译**环境**的维护需要关联到相应的"**职责组**"（通常是运维或 DevOps 团队）。

### 2.8 部署方式管理 (Deployment Management)

*   **2.8.1 部署流程**:
    *   记录将"**服务**"或"**业务**"部署到不同"**环境**"的操作步骤、使用的工具（如 Jenkinsfile、Ansible Playbook、脚本）或说明文档。
*   **2.8.2 部署历史**: （可选，未来可集成）记录部署操作日志（谁、何时、部署了什么版本到哪个**环境**、结果如何）。
*   **2.8.3 职责关联**: 部署流程的定义和执行需要关联到相应的"**职责组**"（通常是运维或 DevOps 团队）。

### 2.9 配置管理 (Configuration Management)

*   **2.9.1 配置项**:
    *   管理"**服务**"或"**业务**"在不同"**环境**"下的配置文件或关键**配置**项（如数据库连接、日志级别、日志目录、功能开关、第三方服务地址等）。
    *   支持**配置**的版本管理和变更历史。
*   **2.9.2 关联性**: **配置**需要与"**服务**"、"**业务**"和"**环境**"相关联。
*   **2.9.3 职责关联**: **配置**的修改和管理需要关联到相应的"**职责组**"。

### 2.10 测试与 Bug 管理 (Testing & Bug Management)

*   **2.10.1 测试用例管理**:
    *   支持创建和管理测试用例。
    *   测试用例需要关联到对应的"**业务**"/"**需求**"和适用的"**环境**"类型。
*   **2.10.2 Bug 报告与跟踪**:
    *   支持提交 **Bug** 报告。
    *   核心关联: **Bug** 报告必须关联到：
        *   测试发生的具体"**环境**"实例。
        *   测试的"**业务**"/"**需求**"。
        *   相关的"**服务**"及其版本号（可通过**环境**和**业务**推断或手动指定）。
        *   测试时的"**配置**"快照（可通过**环境**关联或**数据采集器**获取）。
    *   自动信息收集: 通过与**环境**、**配置**、监控系统（如果集成）及**数据采集器**联动，自动在 **Bug** 报告中填充**环境**详情、**服务**版本、**配置**信息、相关日志片段、当时的告警/监控数据截图等，形成"现场快照"。
    *   智能分配: 根据 **Bug** 关联的**业务**/**服务**，自动将 **Bug** 分配给对应的开发"**职责组**"。
    *   支持 **Bug** 状态跟踪（新建、处理中、已解决、已验证、已关闭等）。
*   **2.10.3 职责关联**: 测试用例编写和执行关联测试"**职责组**"，**Bug** 处理关联开发"**职责组**"。

### 2.11 研发快速接入 (Developer Quick Access)

*   **2.11.1 权限联动**: 当一个 **Bug** 被分配给某个研发人员（属于对应**职责组**）时，系统应能（**待明确：具体实现方式，如调用权限管理 API、执行自动化脚本等**）自动为其开通对该 **Bug** 报告中涉及的特定"**环境**"下相关"**服务**"的日志、**配置**、监控数据的只读访问权限（**待明确：权限范围需精确控制，时效性规则需定义，例如关联 Bug 状态，关闭后自动回收**）。
*   **2.11.2 访问便捷**: 在 **Bug** 页面提供直接访问相关资源的链接或按钮（如：一键拉取相关日志、查看服务状态、访问服务调试接口等）。

### 2.12 基础能力接口 (Unified Interface)

*   **2.12.1 目标**: 针对因**环境**、网络、部署方式多样性导致的操作复杂性，平台应提供统一的接口或操作入口来完成常用任务，封装底层实现细节，屏蔽用户对复杂底层情况的认知负担。
*   **2.12.2 应用场景 - 日志获取**:
    *   *问题描述*: 分析问题时需要获取指定**服务**在特定**环境**下的日志，但由于环境差异，获取方式多样（如：可直接 SSH/SCP 访问、需通过特定管理平台下载、需经过 Jumper 跳转、可通过 HTTP 文件服务中转等），且日志路径也可能不同。
    *   *需求*: 平台提供统一的"获取日志"功能。用户指定目标**服务**、**环境**（及实例，如需）和时间范围/关键字。平台根据关联的**资产**信息（访问方式、凭证管理）、**环境**特定配置、**数据采集器**状态等，自动选择并执行后台获取机制，将结果返回给用户。
*   **2.12.3 应用场景 - 出包与部署**:
    *   *问题描述*: 服务的构建和部署流程复杂多样，涉及不同包格式（RPM, 融合包, Docker 镜像）、目标平台（x86, ARM）、部署工具和流程（Jenkins, DevOps 平台, 手动脚本）。
    *   *需求*: 平台提供统一的"构建/部署"入口。用户选择**服务**/**业务**、版本/分支、目标**环境**。平台根据预定义的**编译环境配置**（2.7）和**部署方式管理**（2.8）信息，自动触发或执行相应的构建和部署流程。
*   **2.12.4 应用场景 - 服务配置管理**:
    *   *问题描述*: 修改服务配置的方式不统一，可能涉及在 GitLab 提交 MR、直接服务器修改文件、通过特定管理平台操作、或需要重新构建 Docker 镜像等。
    *   *需求*: 平台提供统一的"查看/修改配置"接口（需设计严格的权限和审计机制）。用户选择**服务**和**环境**，平台根据**配置管理**（2.9）中记录的维护方式，执行相应操作（如调用 API、执行远程脚本）或提供明确的操作指引/跳转链接。
*   **2.12.5 技术支撑**: 实现上述统一接口需要底层技术（如自动化脚本、**数据采集器**扩展功能、可能的浏览器自动化技术等）的支持。
    *   **V1.0 范围**: **（待明确：V1.0 阶段具体支持哪些场景、自动化程度如何，以及所需的技术支撑细节和优先级）**。

### 2.13 操作审计日志 (Operation Audit Log)

*   **2.13.1 记录范围**: 系统应记录所有用户的关键操作，特别是涉及数据创建、修改、删除、权限变更、配置更改、部署执行、环境操作、敏感数据查看等操作。
*   **2.13.2 记录内容**: 每条日志应至少包含：操作时间戳、操作用户 ID/名称、用户来源 IP 地址、操作对象类型（如：环境、服务、Bug）、操作对象标识（如：环境 ID、服务名称、Bug ID）、操作类型（如：Create, Update, Delete, Login, Logout, GrantPermission, RevokePermission, ViewSensitiveData）、操作结果（成功/失败及原因）、关键参数（如：修改前后的值摘要，但不记录敏感信息如密码）。
*   **2.13.3 日志查询与审计**: 提供安全可靠的日志存储机制（防篡改、定期归档），并提供日志查询界面，支持按时间范围、用户、操作类型、操作对象等条件进行筛选和审计。日志保留策略需明确（如保留 180 天）。
*   **2.13.4 职责关联**: 审计日志的查看权限应严格控制，仅分配给指定的系统管理员或安全审计角色。
### 2.14 通知系统 (Notification System)

*   **2.14.1 通知触发**: 系统应在关键事件发生时自动触发通知，例如：
    *   **Bug** 被分配、状态变更、有新评论。
    *   **需求**状态变更。
    *   **环境**状态变更或维护通知。
    *   **配置**变更审批请求或结果。
    *   部署任务开始、成功、失败。
    *   权限变更。
*   **2.14.2 通知渠道**: 支持多种通知渠道，初期至少支持系统内的站内信/消息中心。未来可考虑扩展支持邮件、即时通讯工具（如企业微信、钉钉）集成。
*   **2.14.3 通知订阅与配置**: 用户可以根据角色和个人偏好，配置希望接收哪些类型的通知以及通过哪些渠道接收。
*   **2.14.4 模板管理**: 管理员可以配置不同类型通知的模板。

## 3. 系统架构组件

*   **3.1 统一客户端 (Unified Client)**:
    *   提供 Web 或桌面统一访问界面。
    *   基于用户角色和权限，动态展示可访问的模块和数据。
    *   提供信息查询、录入、编辑、关联等操作界面。
    *   **提供个性化仪表盘或视图 (Dashboard)**:
        *   **目标**: 为不同角色的用户提供一个信息聚合的入口，快速了解关键状态和待办事项。
        *   **核心功能 (V1.0 建议)**:
            *   **通用**: 显示个人信息、常用功能快捷入口、系统公告、站内信提醒。
            *   **研发人员**: 显示其负责的**服务**概览（如关联的活跃**环境**中的实例状态）、分配给其处理的 **Bug** 列表（按优先级排序）、相关的**需求**状态。
            *   **测试人员**: 显示待测试的**需求**/**Bug** 列表、负责测试的**环境**状态概览、**Bug** 统计（如按状态、严重程度分布）。
            *   **运维人员**: 显示负责维护的**环境**健康度概览（可集成监控告警信息）、近期的部署活动记录、**资产**（特别是服务器）状态概览。
            *   **产品经理**: 显示负责的**业务**/**需求**状态概览、相关的 **Bug** 汇总信息。
        *   **可配置性**: 允许用户在一定程度上自定义仪表盘展示的模块和布局。
*   **3.2 服务端 (Server)**:
    *   提供 API 接口供客户端调用。
    *   实现所有业务逻辑（用户权限、数据关联、流程处理等）。
    *   与数据库交互，存储和管理所有数据。
    *   (可选)与第三方系统(如 Git、Jenkins、监控系统)集成。
*   **3.3 数据库服务 (Database Service)**:
    *   存储系统的所有持久化数据(用户信息、**环境**、**资产**、**服务**、**业务**、**配置**、**Bug** 等)。数据库选型待定(关系型数据库如 PostgreSQL/MySQL 可能是较好选择，因数据关联性强)。
*   **3.4 数据采集器 (Data Collector/Agent)**:
    *   (可选但强烈推荐)轻量级代理程序，部署在需要监控的服务器或终端上。
    *   负责收集信息(如：实时**配置**、日志文件、**服务**状态、系统资源使用情况)。
    *   (可选)接收服务端的指令执行特定任务(如：获取指定日志、执行**配置**更新检查、辅助远程调试)。通信需安全加密。

## 4. 非功能性需求

*   **4.1 性能**:
    *   系统应能支持约 2000 注册用户，**（待明确：峰值并发用户数需根据实际场景评估，例如目标 500 并发）**。在典型操作下（如列表查询、详情查看、表单提交），95% 的请求应在 **（待明确：例如 2 秒）** 内响应。
    *   对于核心高频操作（如 Bug 提交、状态更新），响应时间应更快 **（待明确：例如 1 秒内）**。
    *   对于大量数据(如 10000+ **环境**记录、大量**资产**)的列表查询和筛选应进行优化，保证可用性。
*   **4.2 可用性**:
    *   作为内部核心协作平台，应保证高可用性。**（待明确：设定具体的可用性目标，例如 99.9% 的年度可用率）**。需要设计并实施服务端冗余部署（如集群、负载均衡）、数据库高可用方案（如主从复制、读写分离）和定期的备份与恢复演练机制。
*   **4.3 易用性**:
    *   界面直观、简洁，易于上手。
    *   信息层级清晰，关联关系可视化(如图表或链接)。
    *   提供有效的搜索和筛选功能。
*   **4.4 安全性**:
    *   部署在局域网内，但仍需考虑内部安全。
    *   严格的身份认证和基于角色的访问控制 (RBAC)。
    *   客户端与服务端、**采集器**与服务端之间的通信应加密。
    *   防止未授权的数据访问和操作。
    *   **全面的操作审计日志**: 按照 **2.13 操作审计日志** 的要求，记录所有关键操作，特别是敏感操作（如修改**配置**、删除数据、权限变更等）。
    *   **详细的权限模型**: 需要基于 RBAC 设计非常详细的角色和权限列表，明确每个角色对各个模块（用户、环境、资产、服务、业务、配置、需求、Bug 等）的 CRUD 操作权限，以及特殊操作权限（如部署、配置修改审批等）。**（待明确：需考虑数据行级别的权限控制方案，例如用户只能看到自己负责的 Bug 或环境）**。
    *   开发者临时访问权限需严格控制范围和时效，并有申请审批流程。
*   **4.5 可扩展性**:
    *   系统架构设计应支持未来用户量、数据量、**服务**种类的增长。
    *   易于增加新的功能模块或修改现有模块。
*   **4.6 可维护性**:
    *   代码结构清晰，文档齐全。
    *   易于部署、监控和升级。

*   **4.7 错误处理**: 
    *   **用户界面**: 提供清晰、友好的错误提示信息，引导用户正确操作。
    *   **服务端**: 实现统一的异常捕获和处理机制，记录详细的错误日志（包括堆栈信息、请求上下文），对于关键错误应有告警通知机制。
    *   **API 接口**: 定义标准的错误响应格式和错误码。

*   **4.8 数据校验**: 
    *   **前端校验**: 对用户输入进行基本的格式、长度、类型校验。
    *   **后端校验**: 对所有输入数据进行严格的业务规则校验和安全校验（如防止 SQL 注入、XSS 攻击），确保数据的一致性和完整性。关键校验规则需要文档化。

## 5. 规模估算（重申）

*   **用户**: 约 2000 人(研发、测试、运维、产品等各 300 人左右规模，需支持扩展)。
*   **服务种类**: 约 100 种(需支持扩展)。
*   **服务器/环境**: 单个**环境**最大服务器数约 1000 台(多数情况几十台)，**环境**总数可能达 10000+（大部分仅作记录），活跃访问**环境**约 10+。系统需能高效处理大量记录，并突出活跃**环境**。
*   **客户端**: 种类约十几种，数量庞大，主要需记录类型、版本，并与**业务**关联。

## 6. 需要进一步明确和细化的事项

*   **技术选型细化**: **（待明确）** 需要尽快确定前后端具体的技术栈（例如：后端语言框架 Go/Gin, 前端框架 React/Vue/Svelte + TypeScript, UI 库 MUI/Ant Design/Element Plus, 数据库 PostgreSQL/MySQL）。选择需考虑团队熟悉度、社区支持、性能和生态。
*   **API 接口设计**: **（待明确）** 平台应设计一套稳定、安全、文档完善的 RESTful API 接口。需要明确 API 版本管理策略、认证授权机制（如 OAuth2, JWT）、统一的请求和响应格式、错误码规范。
*   **数据采集器细节**: **（待明确）** 需要详细设计**采集器**的具体功能范围（信息收集、命令执行？）、安全性设计（通信加密、命令执行权限控制、防滥用机制）、资源消耗评估、部署和更新策略。**（待讨论：其必要性、实现优先级，以及是否可以分阶段实施或寻找替代方案）**。
*   **权限模型细化**: **（待明确）** 需要基于 RBAC 非常详细地定义角色及其对应的具体权限，特别是跨模块的数据访问权限和操作权限（如配置修改、环境操作等），并明确数据行级别的权限控制策略和实现方式。
*   **工作流引擎**: **（待明确）** 对于需求、Bug 处理、配置变更等核心流程，需要明确定义状态流转图、各状态下的操作权限、状态转换的触发条件、审批节点（如果需要）、各节点负责人/职责组以及相应的通知机制。**（待讨论：是否引入成熟的工作流引擎，或自研简化版流程管理）**。
*   **数据可视化**: **（待明确）** 明确 Dashboard 和其他报表需要展示的关键指标、数据来源、图表类型和更新频率。
*   **系统配置模块**: **（待明确）** 设计系统级的配置管理功能，例如通知模板、全局开关、第三方集成参数等。
*   **数据迁移策略**: **（待明确）** 如果存在现有系统数据需要迁移，需制定详细的数据迁移计划，包括数据清洗、映射、迁移步骤和验证方案。
*   **集成策略**: **（待明确）** 明确与现有系统（如 Git、CI/CD、监控、项目管理工具）的集成方式（单向同步/双向联动/跳转链接）、集成范围、优先级以及技术实现方案。
*   **优先级排序与范围管理**: **（关键）** 鉴于功能范围较广，**必须**对所有功能模块和需求点进行优先级排序（建议采用 MoSCoW 法：Must have, Should have, Could have, Won't have），明确 V1.0 的核心交付范围，确保项目按时交付关键价值。特别是“基础能力接口”和“数据采集器”等复杂功能，应仔细评估其优先级和分阶段实施的可能性。
